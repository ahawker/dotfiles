#!/usr/bin/env sh
#
# Shell functions and aliases for using the "awscli" dockerfiles image.

# Versions
DOCKERFILES_AWSCLI_1_15_66_VERSION="1.15.66"
DOCKERFILES_AWSCLI_1_15_VERSION="$DOCKERFILES_AWSCLI_1_15_66_VERSION"
DOCKERFILES_AWSCLI_1_VERSION="$DOCKERFILES_AWSCLI_1_15_VERSION"
export DOCKERFILES_AWSCLI_LATEST_VERSION="$DOCKERFILES_AWSCLI_1_VERSION"

# shellcheck disable=2039
declare -a VERSIONS=($DOCKERFILES_AWSCLI_1_15_66_VERSION)
export DOCKERFILES_AWSCLI_VERSIONS="$VERSIONS"

aws() {
	_set_docker_run_image awscli "${IMAGE_VERSION:-$DOCKERFILES_AWSCLI_LATEST_VERSION}" "${IMAGE_TAG:-""}"
	_set_docker_run_args aws "$@"

	docker run \
		--interactive \
		--tty \
		--rm \
		--volume "$HOME/.aws:$HOME/.aws:ro" \
		--env-file "$DOCKERFILES_ENV_FILE" \
		--volume "$(pwd):$DOCKERFILES_WORKDIR" \
		--workdir "$DOCKERFILES_WORKDIR" \
		--env "AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID" \
		--env "AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY" \
		--env "AWS_SESSION_TOKEN=$AWS_SESSION_TOKEN" \
		--env "AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION" \
		--env "AWS_DEFAULT_OUTPUT=$AWS_DEFAULT_OUTPUT" \
		--env "AWS_PROFILE=$AWS_PROFILE" \
		--env "AWS_CA_BUNDLE=$AWS_CA_BUNDLE" \
		--env "AWS_SHARED_CREDENTIALS_FILE=$AWS_SHARED_CREDENTIALS_FILE" \
		--env "AWS_CONFIG_FILE=$AWS_CONFIG_FILE" \
		$DOCKER_RUN_IMAGE $DOCKER_RUN_ARGS
}

_set_aliases_for_image awscli aws "$VERSIONS"

unset DOCKERFILES_AWSCLI_1_15_66_VERSION
unset DOCKERFILES_AWSCLI_1_15_VERSION
unset DOCKERFILES_AWSCLI_1_VERSION
unset VERSIONS
